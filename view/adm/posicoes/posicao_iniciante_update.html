{% extends 'templates/base.html' %}

{% block conteudo %}   
<!-- Janela de atualizada com sucesso -->
    <div id="popup-container" class="popup-container">
        <div class="popup-content">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                <div class="message-container">
                    <ul class="flashes">
                        {% for category, message in messages %}
                            <li class="alert alert-{{ category }}">{{ message }}</li>
                            <span class="close-btn" onclick="this.parentElement.style.display='none';">&times;</span>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            {% endwith %}    
        </div>
    </div>
<!--  -->

    <header>
        <div>
            <a href="{{ url_for('guiabjj_route') }}" class="back-button" style="display: block;">← Voltar para o Guia</a>
        </div>
        <!-- <button class="back-button" onclick="location.href='index.html'" style="display: block;">← Voltar para o Guia</button> -->
        <h1>Administração de Posições</h1>
        <p>Gerencie as posições, variações e passos</p>
    </header>

    <div class="controls admin-controls">
        <a href="{{ url_for('admin_route') }}" class="level-btn active">Iniciante</a> 
        <a href="{{ url_for('interadm_route') }}" class="level-btn">Intermediário</a> 
        <a href="{{ url_for('avancadm_route') }}" class="level-btn">Avançado</a> 
        <a href="{{ url_for('add_position_beginner') }}" class="add-position-btn">Adicionar Nova Posição</a>
        <!-- <button class="level-btn active" data-level="beginner">Iniciante</button>
        <button class="level-btn" data-level="intermediate">Intermediário</button>
        <button class="level-btn" data-level="advanced">Avançado</button>
        <button class="add-position-btn">Adicionar Nova Posição</button> -->
    </div>

    <!-- <div id="admin-content-container">
            <div class="admin-form-container">
                <h2>Adicionar Nova Posição (Beginner)</h2>
                <form id="position-form">
                    <div class="admin-form-group">
                        <label for="position-name">Nome da Posição:</label>
                        <input type="text" id="position-name" name="positionName" value="" required="">
                    </div>
                    <div class="admin-form-group">
                        <label for="position-description">Descrição da Posição:</label>
                        <textarea id="position-description" name="positionDescription" placeholder="Descrição da posição" required=""></textarea>
                    </div>
                    <div class="admin-form-group">
                        <label for="position-image">Imagem Principal (URL/Nome do Arquivo):</label>
                        <input type="text" id="position-image" name="positionImage" value="" placeholder="beginner_guard.png" required="">
                    </div>

                    <h3>Variações</h3>
                    <div id="variations-container-form">                        
                    </div>                    
                    <button type="button" class="add-variation-btn">Adicionar Variação</button>

                    <div class="form-actions">
                        <button type="submit" class="save-btn">Salvar Posição</button>
                        <button type="button" class="cancel-btn">Cancelar</button>
                    </div>
                </form> -->
<div id="admin-content-container">
    <div class="admin-form-container">
        <div class="admin-form-group">
            <div class="container">
                <h1>Editar Posição: {{ position.name }}</h1>

                <form method="POST" action="{{ url_for('edit_position_beginner', position_id=position.id) }}">
                    <div class="form-group">
                        <label for="position_name">Nome da Posição:</label>
                        <input type="text" class="form-control" id="position_name" name="position_name" value="{{ position.name }}" required>
                    </div>
                    <div class="form-group">
                        <label for="position_description">Descrição da Posição:</label>
                        <textarea class="form-control" id="position_description" name="position_description" rows="3" required>{{ position.description }}</textarea>
                    </div>
                    <div class="form-group">
                        <label for="position_image">URL da Imagem da Posição (Opcional):</label>
                        <input type="text" class="form-control" id="position_image" name="position_image" value="{{ position.image or '' }}">
                        {% if position.image %}
                            <img src="{{ position.image }}" alt="{{ position.name }}" style="max-width: 200px; margin-top: 10px;">
                        {% endif %}
                    </div>

                    <hr>
                    <h2>Variações</h2>
                    <div id="variations-container">
                        {% for variation in position.variations %}
                            {% set variation_index = loop.index0 %} <div class="variation-card" data-variation-index="{{ variation_index }}">
                                <div class="form-group">
                                    <label for="variation_name_{{ variation_index }}">Nome da Variação:</label>
                                    <input type="text" class="form-control" name="variation_name[]" value="{{ variation.name }}" required>
                                </div>
                                <div class="form-group">
                                    <label for="variation_desc_{{ variation_index }}">Descrição da Variação:</label>
                                    <textarea class="form-control" name="variation_desc[]" rows="2" required>{{ variation.description }}</textarea>
                                </div>

                                <h4>Passos para Variação "{{ variation.name }}"</h4>
                                <div class="steps-container" id="steps-container-{{ variation_index }}">
                                    {% for step in variation.steps %}
                                        <div class="step-card" data-step-index="{{ variation_index }}-{{ loop.index0 }}">
                                            <div class="form-group">
                                                <label for="step_img_{{ variation_index }}_{{ loop.index0 }}">URL da Imagem do Passo (Opcional):</label>
                                                <input type="text" class="form-control" name="step_img_{{ variation_index + 1 }}[]" value="{{ step.img or '' }}">
                                                {% if step.img %}
                                                    <img src="{{ step.img }}" alt="Passo" style="max-width: 100px; margin-top: 5px;">
                                                {% endif %}
                                            </div>
                                            <div class="form-group">
                                                <label for="step_desc_{{ variation_index }}_{{ loop.index0 }}">Descrição do Passo:</label>
                                                <textarea class="form-control" name="step_desc_{{ variation_index + 1 }}[]" rows="2" required>{{ step.description }}</textarea>
                                            </div>
                                            <button type="button" class="btn btn-danger btn-sm remove-step-btn">Remover Passo</button>
                                        </div>
                                    {% endfor %}
                                </div>
                                <button type="button" class="btn btn-info btn-sm add-step-btn" data-variation-index="{{ variation_index }}">Adicionar Passo</button>
                                <button type="button" class="btn btn-danger btn-sm remove-variation-btn">Remover Variação</button>
                            </div>
                        {% endfor %}
                    </div>
                    <button type="button" class="btn btn-success mt-3" id="add-variation-btn">Adicionar Variação</button>

                    <button type="submit" class="btn btn-primary btn-lg mt-4">Salvar Alterações</button>
                    <a href="{{ url_for('admin_route') }}" class="btn btn-secondary btn-lg mt-4">Cancelar</a>
                </form>
            </div>
        </div>
    </div>
</div>



{% endblock %}
